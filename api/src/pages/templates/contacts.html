{% extends "base.html" %}

{% block title %}Contact Us{% endblock %}

{% block content %}
<div style="padding-left: 10px;">
    <h2>Свяжитесь с нами</h2>
    <p>По всем вопросам обращаться:</p>
    <ul>
        <li>Email: <a href="paxa@gmail.com">paxa@gmail.com</a></li>
        <li>Телефон: +123 456 7890</li>
        <li>Адрес: Гороховский переулок 4</li>
    </ul>
</div>

<script>
    async function sendRequest() {
        let token = localStorage.getItem('token') || sessionStorage.getItem('token');

        if (token === null) {
            window.location.href = '/pages/login';
            return;
        }

        const response = await fetch('/api/v1/check_token', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'auth': token,
            }
        });

        if (response.status === 401) {
            let rt = localStorage.getItem('refresh_token') || sessionStorage.getItem('refresh_token')

            if (rt === null) {
                localStorage.clear();
                window.location.href = '/pages/login';
                return;
            }

            const rtResponse = await fetch('/api/v1/auth/refresh', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'token': rt,
                }
            });

            if (rtResponse.ok) {
                const data = await rtResponse.json();
                localStorage.clear();
                sessionStorage.clear();
                localStorage.setItem('token', data.token);
                localStorage.setItem('refresh_token', data.refresh_token);
                sessionStorage.setItem('token', data.token);
                sessionStorage.setItem('refresh_token', data.refresh_token);
            } else {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = '/pages/login';
            }
        }
    }

    window.onload = function() {
        sendRequest();
    };
</script>

{% endblock %}